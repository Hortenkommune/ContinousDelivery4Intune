{"Function":"\r\n    function Register-ChocoSource {\r\n        param (\r\n            $Name,\r\n            $Server\r\n        )\r\n        $ChocoBin = $env:ProgramData + \"\\Chocolatey\\bin\\choco.exe\"\r\n        if (Test-Path -Path $ChocoBin) {\r\n            $sources = Invoke-Expression \"cmd /c $ChocoBin source\"\r\n            $regged = $false\r\n            foreach ($s in $sources) {\r\n                if ($s -like \"$Name - http://$Server/chocolatey*\") {\r\n                    $regged = $true\r\n                }\r\n            }\r\n            if ($regged -eq $false) {\r\n                Write-Log -Value \"$Name not registered as chocosource; registering\" -Severity 1 -Component \"Register-ChocoSource\"\r\n                Invoke-Expression \"cmd /c $ChocoBin source add --name=$Name --source=http://$Server/chocolatey --priority=0\"\r\n                Invoke-Expression \"cmd /c $ChocoBin source add --name=chocolatey --priority=1\"\r\n            }\r\n            else {\r\n                Write-Log -Value \"$Name already registered as chocosource; skipping\" -Severity 1 -Component \"Register-ChocoSource\"\r\n            }\r\n        }\r\n        else {\r\n            Write-Log -Value \"$ChocoBin not detected; chocolatey is not installed!!!! aborting\" -Severity 3 -Component \"Register-ChocoSource\"\r\n        }\r\n    }\r\n","Execute":"\r\n    Param(\r\n        $cfguri = $null\r\n    )\r\n    if ($cfguri -ne $null) {\r\n        $cfg = Invoke-RestMethod $cfguri -UseBasicParsing\r\n        Register-ChocoSource -Name $cfg.Name -Server $cfg.Server\r\n    }\r\n","Name":"Register-ChocoSource"}
