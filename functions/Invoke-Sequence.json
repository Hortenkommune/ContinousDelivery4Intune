{"Function":"\r\n    function Invoke-Sequence {\r\n        param (\r\n            [string]$Name,\r\n            [psobject]$FilesToDownload,\r\n            [psobject]$Execution,\r\n            [psobject]$Detection,\r\n            [string]$WorkingDirectory = \"C:\\Windows\\Temp\"\r\n        )\r\n\r\n        $DetectionRulesCount = $Detection | Measure-Object | Select-Object -ExpandProperty Count\r\n        $DetectionCounter = 0\r\n\r\n        Write-Log -Value \"Starting detection of $Name\" -Severity 1 -Component \"AdvancedApplication\"\r\n\r\n        foreach ($detect in $Detection) {\r\n            $DetectionRule = $detect | Select-Object -ExpandProperty Rule\r\n            $runDetectionRule = Invoke-Expression -Command $DetectionRule\r\n            if ($runDetectionRule -eq $true) {\r\n                $DetectionCounter++\r\n            }\r\n        }\r\n\r\n        If (!($DetectionRulesCount -eq $DetectionCounter)) {\r\n            Write-Log -Value \"$Name is not detected; starting installation\" -Severity 1 -Component \"AdvancedApplication\"\r\n            foreach ($download in $FilesToDownload) {\r\n                $URL = $download | Select-Object -ExpandProperty URL\r\n                $FileName = $download | Select-Object -ExpandProperty FileName\r\n                Write-Log -Value \"Downloading $URL\" -Severity 1 -Component \"AdvancedApplication\"\r\n                Invoke-WebRequest -Uri $URL -OutFile (Join-Path -Path $WorkingDirectory -ChildPath $FileName)\r\n                Write-Log -Value \"$URL downloaded\" -Severity 1 -Component \"AdvancedApplication\"\r\n            }\r\n            foreach ($Execute in $Execution) {\r\n                $Program = $Execute | Select-Object -ExpandProperty Execute\r\n                $Arguments = $Execute | Select-Object -ExpandProperty Arguments\r\n                Write-Log -Value \"Executing $Program with arguments $Arguments\" -Severity 1 -Component \"AdvancedApplication\"\r\n                Start-Process -FilePath $Program -ArgumentList $Arguments -Wait\r\n                Write-Log -Value \"$Program completed\" -Severity 1 -Component \"AdvancedApplication\"\r\n            }\r\n            foreach ($download in $FilesToDownload) {\r\n                $FileName = $download | Select-Object -ExpandProperty FileName\r\n                Remove-Item (Join-Path -Path $WorkingDirectory -ChildPath $FileName) -Force\r\n            }\r\n            Write-Log -Value \"Installation of $Name completed\" -Severity 1 -Component \"AdvancedApplication\"\r\n        }\r\n        else {\r\n            Write-Log -Value \"$Name is already installed; skipping\" -Severity 1 -Component \"AdvancedApplication\"\r\n        }\r\n    }\r\n","Execute":"\r\n    param(\r\n        $cfguri = $null\r\n    )\r\n    if ($cfguri -ne $null) {\r\n        $cfg = Invoke-RestMethod $cfguri -UseBasicParsing\r\n        foreach ($i in $cfg) {\r\n            Invoke-Sequence -Name $i.Name -FilesToDownload $i.FilesToDownload -Execution $i.Execution -Detection $i.Detection\r\n        }\r\n    }\r\n","Name":"Invoke-Sequence"}
