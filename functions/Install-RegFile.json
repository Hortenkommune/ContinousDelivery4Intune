{"Function":"\r\n    function Install-RegFile {\r\n        param (\r\n            $URL,\r\n            $detection,\r\n            $Type\r\n        )\r\n        Write-Log -Value \"Starting detection of Regedit settings; $URL\" -Severity 1 -Component \"Install-RegFile\"\r\n        $runDetectionRule = Invoke-Expression -Command $detection\r\n        If (!($runDetectionRule -eq $true)) {\r\n            Write-Log -Value \"Regedit settings not detected; starting install; $URL\" -Severity 1 -Component \"Install-RegFile\"\r\n            $TempFile = Join-Path -Path $env:TEMP -ChildPath \"TempRegFile.reg\"\r\n            Remove-Item $TempFile -Force -ErrorAction Ignore\r\n            Invoke-WebRequest -Uri $URL -OutFile $TempFile\r\n            $Arguments = \"/s $TempFile\"\r\n\r\n            if ($Type -eq \"HKCU\") {\r\n                Write-Log -Value \"Regedit settings is HKCU; $URL\" -Severity 1 -Component \"Install-RegFile\"\r\n                $regfile = Get-Content $TempFile\r\n                $hives = Get-ChildItem -Path REGISTRY::HKEY_USERS | Select-Object -ExpandProperty Name\r\n                foreach ($hive in $hives) {\r\n                    if (!($hive -like \"*_Classes\")) {\r\n                        $newregfile = $regfile -replace \"HKEY_CURRENT_USER\", $hive\r\n                        Set-Content -Path $TempFile -Value $newregfile\r\n                        Start-Process \"regedit.exe\" -ArgumentList $Arguments -Wait\r\n                    }\r\n                }\r\n            }\r\n            elseif ($Type -eq \"HKLM\") {\r\n                Write-Log -Value \"Regedit settings is HKLM; $URL\" -Severity 1 -Component \"Install-RegFile\"\r\n                Start-Process \"regedit.exe\" -ArgumentList $Arguments -Wait\r\n            }\r\n            \r\n        }\r\n        Else {\r\n            Write-Log -Value \"Regedit settings is detected, aborting install; $URL\" -Severity 1 -Component \"Install-RegFile\"\r\n        }\r\n    }\r\n","Execute":"\r\n    param(\r\n        $cfguri = $null\r\n    )\r\n    if ($cfguri -ne $null) {\r\n        $cfg = Invoke-RestMethod $cfguri -UseBasicParsing\r\n        foreach ($i in $cfg) {\r\n            Install-RegFile -URL $i.URL -detection $i.detection -Type $i.Type\r\n        }\r\n    }\r\n","Name":"Install-RegFile"}
