{"Function":"\r\n    function Invoke-WindowsActivation {\r\n        Write-Log -Value \"Ensuring Windows 10 retail activation\" -Severity 1 -Component \"slmgr\"\r\n\r\n        $20DA = [bool](Get-WmiObject -Query \"select * from win32_computersystem where model like \u002720DA%\u0027\")\r\n        if ($20DA -eq $true) {\r\n            Write-Log -Value \"Reactivating Windows 10 on 20DA\" -Severity 1 -Component \"slmgr\"\r\n            try {\r\n                $ClientKey = \"NW6C2-QMPVW-D7KKK-3GKT6-VCFB2\"\r\n                $KMSHost = \"10.82.17.21\"\r\n                $SLS = Get-WmiObject -Class \"SoftwareLicensingService\"\r\n                $SLS.InstallProductKey($ClientKey)\r\n                $SLS.SetKeyManagementServiceMachine($KMSHost)\r\n                $SLS.RefreshLicenseStatus()\r\n                Write-Log -Value \"Windows 10 has been reactivated\" -Severity 1 -Component \"slmgr\"\r\n            }\r\n            catch {\r\n                Write-Log -Value \"Windows 10 failed to reactivate\" -Severity 3 -Component \"slmgr\"\r\n            }\r\n        }\r\n        else {\r\n            $SLP = Get-WmiObject -Class \"SoftwareLicensingProduct\" -Filter \"KeyManagementServiceMachine = \u002710.85.16.21\u0027 OR DiscoveredKeyManagementServiceMachineIpAddress = \u002710.85.16.21\u0027\"\r\n            if ($SLP) {\r\n                Write-Log -Value \"Need to convert to Windows 10 retail activation; initiating\" -Severity 1 -Component \"slmgr\"\r\n                try {\r\n                    Write-Log -Value \"Fetching OEM key\" -Severity 1 -Component \"slmgr\"\r\n                    $SLS = Get-WmiObject -Class \"SoftwareLicensingService\"\r\n                    Write-Log -Value \"OEM key fetched; uninstalling KMS key\" -Severity 1 -Component \"slmgr\"\r\n                    $SLP.UninstallProductKey()\r\n                    $SLS.ClearProductKeyFromRegistry()\r\n                    Write-Log -Value \"KMS key uninstalled; installing fetched OEM key\" -Severity 1 -Component \"slmgr\"\r\n                    Start-Process \"changepk.exe\" -ArgumentList \"/ProductKey $($SLS.OA3xOriginalProductKey)\"\r\n                    Write-Log -Value \"Converted to Windows 10 retail activation\" -Severity 1 -Component \"slmgr\"\r\n                }\r\n                catch {\r\n                    Write-Log -Value \"Failed to convert to Windows 10 retail activation\" -Severity 3 -Component \"slmgr\"\r\n                }\r\n            }\r\n            else {\r\n                Write-Log -Value \"No action needed; skipping\" -Severity 1 -Component \"slmgr\"\r\n            }\r\n        }\r\n    }\r\n","Execute":"\r\n    Invoke-WindowsActivation\r\n","Name":"Invoke-WindowsActivation"}
